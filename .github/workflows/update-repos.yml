name: Update Repositories

on: 
  schedule:
    - cron:  '0 0 * * *'  # Runs daily at midnight UTC
  workflow_dispatch:  # Allows manual trigger

jobs: 
  update-repos:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name:  Fetch and update repositories
        run: |
          # Fetch all repositories
          curl -s "https://api.github.com/users/dedbot365/repos?per_page=100&sort=updated&direction=desc" > repos. json
          
          # Create markdown table header
          cat > repos_section.md << 'EOF'
          | Repository | Description | Language | Stars | Forks | Last Updated |
          |------------|-------------|----------|-------|-------|--------------|
          EOF
          
          # Parse JSON and create table rows
          jq -r '.[] | "| [\(. name)](\(.html_url)) | \(.description // "No description") | \(.language // "N/A") | â­ \(.stargazers_count) | ðŸ”± \(.forks_count) | \(.updated_at | split("T")[0]) |"' repos.json >> repos_section. md
          
          # Update README. md between markers
          sed -i '/<!-- REPOS-START -->/,/<!-- REPOS-END -->/{//!d}' README.md
          sed -i '/<!-- REPOS-START -->/r repos_section.md' README. md
          
          # Cleanup
          rm repos.json repos_section.md
          
      - name:  Commit and push if changed
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user. email 'github-actions[bot]@users. noreply.github.com'
          git add README.md
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "docs: Auto-update repositories list [skip ci]"
            git push
          fi
